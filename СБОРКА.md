# Система сборки Browser Tracker

> **Инструмент разработчика** для дебага и отслеживания активности браузера на локальном сервере (http://localhost:8012)

## Быстрый старт

### Установка Bun (если ещё не установлен)
```bash
powershell -c "irm bun.sh/install.ps1 | iex"
```

## Команды

### Сборка всех версий
```bash
bun run build
```

### Сборка конкретной версии
```bash
bun run build:firefox-dev      # Firefox с popup
bun run build:firefox-prod     # Firefox без popup (продакшн)
bun run build:chrome-dev       # Chrome с popup
bun run build:chrome-prod      # Chrome без popup (продакшн)
bun run build:opera-dev        # Opera с popup
bun run build:opera-prod       # Opera без popup (продакшн)
```

### Упаковка в ZIP
```bash
bun run pack                   # Только упаковать
bun run build:pack            # Собрать и упаковать
```

### Очистка
```bash
bun run clean                  # Удалить dist/ и packed/
```

## Версии

### Development (с popup)
- Включает popup.html и popup.js для отладки
- Можно открыть интерфейс расширения

### Production (без popup)
- Только фоновая работа
- Нет интерфейса пользователя

## Различия браузеров

### Firefox
- Manifest v2
- Поддерживает `webRequest` с блокировкой
- Требует `browser_specific_settings` с ID расширения

### Chrome/Opera
- Manifest v3
- Service Worker вместо background scripts
- `host_permissions` отдельно от `permissions`
- ⚠️ `webRequestBlocking` не поддерживается - нужен `declarativeNetRequest`

## Структура файлов

```
browserTracker/                # Исходники
├── manifest.json
├── background.js
├── popup.html
├── popup.js
└── icons/

dist/                         # Сборки
├── firefox-dev/
├── firefox-prod/
├── chrome-dev/
├── chrome-prod/
├── opera-dev/
└── opera-prod/

packed/                       # ZIP архивы
├── firefox-dev.zip
├── firefox-prod.zip
├── chrome-dev.zip
├── chrome-prod.zip
├── opera-dev.zip
└── opera-prod.zip
```

## Настройка

Конфигурации находятся в [build.config.ts](build.config.ts).

Можно изменить:
- Название и версию расширения
- Разрешения (permissions)
- Директории вывода
- ID расширения для Firefox

## Установка расширения для тестирования

### Firefox
1. `about:debugging#/runtime/this-firefox`
2. "Load Temporary Add-on"
3. Выбрать `manifest.json` из `dist/firefox-dev/`

### Chrome
1. `chrome://extensions/`
2. Включить "Developer mode"
3. "Load unpacked"
4. Выбрать папку `dist/chrome-dev/`

### Opera
1. `opera://extensions/`
2. Включить "Developer mode"
3. "Load unpacked extension"
4. Выбрать папку `dist/opera-dev/`

## Публикация

Используйте файлы из `packed/`:
- [Firefox Add-ons](https://addons.mozilla.org/developers/) - `firefox-prod.zip`
- [Chrome Web Store](https://chrome.google.com/webstore/devconsole) - `chrome-prod.zip`
- [Opera Addons](https://addons.opera.com/developer/) - `opera-prod.zip`

### WebKit/Safari
1. Используйте сборку Chrome (`dist/chrome-dev/`)
2. В Safari откройте Develop → Show Extension Builder
3. Нажмите + → Add Extension
4. Выберите папку `dist/chrome-dev/`
5. Или конвертируйте через `xcrun safari-web-extension-converter dist/chrome-dev/`

## Проблемы с Opera

Opera использует тот же движок Chromium, что и Chrome. Если расширение не работает:

1. ✅ Используйте manifest v3 (сборки `opera-dev` и `opera-prod`)
2. ✅ Проверьте консоль ошибок в `opera://extensions/`
3. ⚠️ В manifest v3 `webRequestBlocking` не работает - нужен `declarativeNetRequest`

Если в вашем расширении используется `webRequest` с блокировкой, нужно будет переписать логику на `declarativeNetRequest` API.

## Дополнительная информация

Подробная документация: [BUILD_README.md](BUILD_README.md)
